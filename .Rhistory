pdf("figures/FEDRR_all_2024/date.NY-OH-IA_facet.pdf", width = 28, height = 6)
grid.arrange(p9,p7,p8,ncol = 3, widths = c(0.33,0.33,0.33))
dev.off()
p9 = ggplot(nmds.metadata %>% filter(State == "IA"),
aes(x = bray_bin.NMDS1, y = bray_bin.NMDS2, color = as.integer(mdy), shape = Site)
) +
scale_shape_manual(values = c(16,17,15,3,7,8,5)) +
geom_point(size = 3) +
scale_color_gradientn(colours = rev(five_cols_gradient_palette), breaks = date_breaks, guide = guide_colorbar(title = element_blank(), order = 2)) +
labs(x="NMDS1", y = "NMDS2", color = "Risk level", title = "Iowa") +
my_gg_theme +
theme(
legend.title = element_text(size = 16)
)
p9
pdf("figures/FEDRR_all_2024/date.NY-OH-IA_facet.pdf", width = 28, height = 6)
grid.arrange(p9,p7,p8,ncol = 3, widths = c(0.3,0.33,0.33))
dev.off()
grid.arrange(p9,p7,p8,ncol = 3, widths = c(0.3,0.33,0.36))
pdf("figures/FEDRR_all_2024/date.NY-OH-IA_facet.pdf", width = 28, height = 6)
grid.arrange(p9,p7,p8,ncol = 3, widths = c(0.3,0.33,0.36))
dev.off()
pdf("figures/FEDRR_all_2024/date.NY-OH-IA_facet.pdf", width = 28, height = 6)
grid.arrange(p9,p7,p8,ncol = 3, widths = c(0.31,0.33,0.35))
dev.off()
q(save="no")
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA)
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA_02102025.txt", header = F)
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata, "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata, "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata, "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata, "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata, "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
metadata.NH
metadata.NH$trapID
head(id_mapping)
?grep
id_mapping$SequenceID %>% grep("^NH", .)
id_mapping$SequenceID[id_mapping$SequenceID %>% grep("^NH", .)]
head(id_mapping)
id_mapping$trapID[id_mapping$SequenceID %>% grep("^NH", .)]
id_mapping$trapID[id_mapping$SequenceID %>% grep("^NH", .)] %>% unique
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_join(id_mapping[id_mapping$SequenceID %>% grep("^NH", .),], metadata.NH, by = "trapID")
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
NH_id_mapping = id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
NH_id_mapping
NH_id_mapping[37,]
source("~/repo/BIL_pathogens/collate_metadata/NY-OH-IA-NH_metadata.R", echo=TRUE)
metadata.NH
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
NH_id_mapping = id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_join(id_mapping[id_mapping$SequenceID %>% grep("^NH", .),], metadata.NH, by = "trapID")
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata, "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_join(id_mapping[id_mapping$SequenceID %>% grep("^NH", .),], metadata.NH, by = "trapID")
test.nh = full_join(id_mapping[id_mapping$SequenceID %>% grep("^NH", .),], metadata.NH, by = "trapID")
nrow(test.nh)
ncol(test.nh)
test.nh %>% print(n = Inf)
test.nh %>% as_tibble() %>% %>% print(n = Inf)
test.nh %>% as_tibble() %>% print(n = Inf)
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
full_metadata %>% filter(State = "NH")
full_metadata %>% filter(State == "NH")
full_metadata$State %>% unique()
metadata.NH
test.nh
test.full = full_join(id_mapping, metadata, by = "trapID")
test.full$State %>% unique()
str(metadata.NH)
str(metadata.IA)
NH_id_mapping
NH_id_mapping$trapID %>% unique()
metadata.NH$trapID %>% unique()
test.nh
nrow(test.nh)
nrow(NH_id_mapping)
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
metadata = rbind(metadata.NY, metadata.OH, metadata.IA, metadata.NH)
colnames(metadata.IA)
colnames(metadata.NH)
colnames(metadata.NH)
colnames(metadata.IA)
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
colnames(metadata.NH)
colnames(metadata.IA)
metadata = rbind(metadata.NY, metadata.OH, metadata.IA, metadata.NH)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
NH_id_mapping = id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
NH_id_mapping$trapID %>% unique()
metadata.NH$trapID %>% unique()
test.nh = full_join(id_mapping[id_mapping$SequenceID %>% grep("^NH", .),], metadata.NH, by = "trapID")
nrow(test.nh)
nrow(NH_id_mapping)
test.full = full_join(id_mapping, metadata, by = "trapID")
test.full$State %>% unique()
test.full %>% filter(is.na(State))
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
full_metadata %>% filter(State == "NH")
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata, "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
q(save="no")
library(dplyr)
source("library/library.R")
#asv_tab = read.table("~/FEDRR_all_2024/dada2_core/ASVs_counts.tsv", header = T)
asv_tab = read.table("data/FEDRR_all_2024/ASVs_counts.tsv", header = T)
ncol(asv_tab)
nrow(asv_tab)
colnames(asv_tab)
rownames(asv_tab)
#mod names to get rid of Illumina index ID
colnames(asv_tab) = sub("_S\\d+", "", colnames(asv_tab),perl = T)
colnames(asv_tab)
rownames(asv_tab)
#mod names to get rid of Illumina index ID
colnames(asv_tab) = sub("_S\\d+", "", colnames(asv_tab),perl = T)
colnames(asv_tab)
#metadata = read.csv("~/FEDRR_all_2024/collated_metadata_NY-OH-IA_02102025.csv")
metadata = read.csv("data/2024_metadata/collated/collated_metadata_NY-OH-IA_02102025.csv")
head(metadata)
nrow(metadata)
#metadata = read.csv("~/FEDRR_all_2024/collated_metadata_NY-OH-IA_02102025.csv")
metadata = read.csv("data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv")
head(metadata)
nrow(metadata)
colnames(asv_tab)
sub("-", ".", metadata$SequenceID)
metadata$SequenceID = sub("-", ".", metadata$SequenceID)
baseline_ids = metadata %>% filter(BaselineType == "BLO") %>% pull(SequenceID)
baseline_ids %>% length
metadata$dateOrType %>% unique()
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
colnames(metadata.NH)
colnames(metadata.IA)
metadata = rbind(metadata.NY, metadata.OH, metadata.IA, metadata.NH)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
write.csv(full_metadata %>% select(-BaselineType), "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrBLtype = lapply(sampleID.split, function(x) x[2]) %>% unlist
head(full_metadata)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
colnames(metadata.NH)
colnames(metadata.IA)
metadata = rbind(metadata.NY, metadata.OH, metadata.IA, metadata.NH)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrBaselineType = lapply(sampleID.split, function(x) x[2]) %>% unlist
write.csv(full_metadata %>% select(-BaselineType), "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
full_metadata$SequenceID = sub("-", ".", full_metadata$SequenceID)
write.csv(full_metadata %>% select(-BaselineType), "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
#funnel trap metadata
metadata = read.csv("data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv")
head(metadata)
nrow(metadata)
metadata$dateOrType %>% unique()
metadata$dateOrBaselineType %>% unique()
baseline_ids = metadata %>% filter(dateOrBaselineType == "BLO" | dateOrBaselineType == "BLF") %>% pull(SequenceID)
baseline_ids %>% length
baseline_ids %>% length
pcrNeg_ids = metadata %>% filter(dateOrBaselineType == "negative") %>% pull(SequenceID)
pcrNeg_ids %>% length
samples_ids = metadata %>% filter(dateOrBaselineType != "BLO" & dateOrBaselineType != "PCRnegative" & !SequenceID %in% c("NY.42", "NY.35")) %>% pull(SequenceID)
samples_ids %>% length
samples_ids %>% length
samples_ids
samples_ids %>% length
baseline_ids %>% length
pcrNeg_ids %>% length
ncol(asv_tab)
nrow(asv_tab)
#note the samps does not include Eli's samples
#we need to negative filter based on BL and PCR neg
# also add Ny.42 and NY.35
toss_these = c(baseline_ids, pcrNeg_ids, "NY.42", "NY.35")
length(toss_these)
ncol(asv_tab)
ncol(asv_tab) - length(toss_these)
######################
#all samples
asv_tab.keeps = asv_tab[,!colnames(asv_tab) %in% toss_these]
ncol(asv_tab.keeps) == ncol(asv_tab) - length(toss_these)
ncol(asv_tab.keeps)
nrow(asv_tab.keeps)
!colnames(asv_tab.keeps) %in% metadata$SequenceID
metadata$SequenceID[!colnames(asv_tab.keeps) %in% metadata$SequenceID]
threw_outs = metadata$SequenceID[!colnames(asv_tab.keeps) %in% metadata$SequenceID]
metadata %>% filter(SequenceID %in% threw_outs)
ncol(asv_tab) - length(toss_these)
ncol(asv_tab.keeps)
all_keeps = colnames(asv_tab.keeps)
toss_these[!toss_these %in% colnames(asv_tab)]
msising_ids = toss_these[!toss_these %in% colnames(asv_tab)]
metadata %>% filter(SequenceID %in% msising_ids)
colnames(asv_tab)
nrow(metadata)
nrow(metadata) - length(toss_these)
?grep
length( grep("^X", colnames(asv_tab) ))
nrow(metadata) - length(toss_these) + length( grep("^X", colnames(asv_tab) ))
#how many samples with gt 1k seqs
sum(colSums(asv_tab.baseline) > 999)
#how many samples with gt 1k seqs
sum(colSums(asv_tab.keeps) > 999)
#437
colSums(asv_tab.keeps) %>% sort
#how many samples with gt 1k seqs
sum(colSums(asv_tab.keeps) > 999)
#
#how many nonzero asvs
sum(rowSums(asv_tab.keeps) > 0)
#Checking just the ST samples
asv_tab.ST = asv_tab[,colnames(asv_tab) %in% grep("^X", colnames(asv_tab)]
#Checking just the ST samples
asv_tab.ST = asv_tab[,colnames(asv_tab) %in% grep("^X", colnames(asv_tab)) ]
length(asv_tab.ST)
ncol(asv_tab.ST)
grep("^X", colnames(asv_tab))
#Checking just the ST samples
asv_tab.ST = asv_tab[,grep("^X", colnames(asv_tab)) ]
ncol(asv_tab.ST)
sum(colSums(asv_tab.ST) > 999)
#34
colSums(asv_tab.ST) %>% sort
#
#how many nonzero asvs
sum(rowSums(asv_tab.ST) > 0)
#13355
sum(rowSums(asv_tab.ST) > 0)/sum(rowSums(asv_tab.keeps) > 0)
#
asv_tab.nST = asv_tab[,!grep("^X", colnames(asv_tab)) ]
ncol(asv_tab.nST)
#
asv_tab.nST = asv_tab[,-grep("^X", colnames(asv_tab)) ]
ncol(asv_tab.nST)
#504
sum(colSums(asv_tab.nST) > 999)
#
#how many nonzero asvs
sum(rowSums(asv_tab.nST) > 0)
#32135
sum(rowSums(asv_tab.nST) > 0)/sum(rowSums(asv_tab.keeps) > 0)
#13355
sum(rowSums(asv_tab.ST) > 0)/sum(rowSums(asv_tab.keeps) > 0)
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
colnames(metadata.NH)
colnames(metadata.IA)
metadata = rbind(metadata.NY, metadata.OH, metadata.IA, metadata.NH)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrBaselineType = lapply(sampleID.split, function(x) x[2]) %>% unlist
full_metadata$SequenceID = sub("-", ".", full_metadata$SequenceID)
write.csv(full_metadata %>% select(-BaselineType), "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
#funnel trap metadata
metadata = read.csv("data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv")
head(metadata)
nrow(metadata)
# we do not have the complete metadata for the spore traps at this point
# I.e., we don't even have the sequence-ssampleID mapping
# but we can just filter these based on the sample names (all began with a
# number so now begin with X)
# Our goal is just to output a table of all the "real" samples to send to Eli
# and for rarefaction/averaging, so we won't bother with the ST metadata for now
metadata$dateOrBaselineType %>% unique()
baseline_ids = metadata %>% filter(dateOrBaselineType == "BLO" | dateOrBaselineType == "BLF") %>% pull(SequenceID)
baseline_ids %>% length
pcrNeg_ids = metadata %>% filter(dateOrBaselineType == "negative") %>% pull(SequenceID)
pcrNeg_ids %>% length
samples_ids = metadata %>% filter(dateOrBaselineType != "BLO" & dateOrBaselineType != "PCRnegative" & !SequenceID %in% c("NY.42", "NY.35")) %>% pull(SequenceID)
samples_ids %>% length
samples_ids
#note the samps does not include Eli's samples
#we need to negative filter based on BL and PCR neg
# also add Ny.42 and NY.35
toss_these = c(baseline_ids, pcrNeg_ids, "NY.42", "NY.35")
length(toss_these)
ncol(asv_tab) - length(toss_these)
nrow(metadata) - length(toss_these) + length( grep("^X", colnames(asv_tab) ))
#444
######################
#all samples
asv_tab.keeps = asv_tab[,!colnames(asv_tab) %in% toss_these]
ncol(asv_tab.keeps) == ncol(asv_tab) - length(toss_these)
ncol(asv_tab.keeps)
nrow(asv_tab.keeps)
# the ncol is 4 greater than expected from subtracting the lengths bc there are
# four PCR negatives that do not appear in the ASV tab bc they had no reads at all
# there are also four samples missing based on the 444 above. These are samps
# that had zero reads
metadata %>% filter(reads_per_sample < 1000)
metadata
metadata %>% filter(num_reads < 1000)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
colnames(metadata.NH)
colnames(metadata.IA)
metadata = rbind(metadata.NY, metadata.OH, metadata.IA, metadata.NH)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
full_join(id_mapping, metadata, by = "trapID")
reads_per_sample
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
nrow(full_metadata)
nrow(reads_per_sample)
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
nrow(reads_per_sample)
library(dplyr)
metadata.NY = read.csv("data/2024_metadata/collated/metadata.NY.csv")
metadata.OH = read.csv("data/2024_metadata/collated/metadata.OH.csv")
metadata.IA = read.csv("data/2024_metadata/collated/metadata.IA.csv")
metadata.NH = read.csv("data/2024_metadata/collated/metadata.NH.csv")
colnames(metadata.NH)
colnames(metadata.IA)
metadata = rbind(metadata.NY, metadata.OH, metadata.IA, metadata.NH)
ncol(metadata)
id_mapping = read.csv("data/2024_metadata/collated/sampleID_mapping_NY-OH-IA-NH_02102025.csv")
reads_per_sample = read.table("data/2024_metadata/collated/reads_per_sample_NY-OH-IA-NH_02102025.txt", header = F)
colnames(reads_per_sample) = c("SequenceID", "num_reads")
head(reads_per_sample)
head(id_mapping)
metadata.NH$trapID
id_mapping[id_mapping$SequenceID %>% grep("^NH", .),]
nrow(reads_per_sample)
full_metadata = full_join(id_mapping, metadata, by = "trapID") %>%
full_join(., reads_per_sample, by = "SequenceID")
head(full_metadata)
nrow(full_metadata)
sampleID.split = strsplit(full_metadata$sampleID, " ", fixed = T)
full_metadata$dateOrBaselineType = lapply(sampleID.split, function(x) x[2]) %>% unlist
full_metadata$SequenceID = sub("-", ".", full_metadata$SequenceID)
write.csv(full_metadata %>% select(-BaselineType), "data/2024_metadata/collated/collated_metadata_NY-OH-IA-NH_02102025.csv", row.names = F)
q(save="no")
